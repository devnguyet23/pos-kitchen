# Há»† THá»NG PHÃ‚N QUYá»€N POS QUáº¢N LÃ CHUá»–I Cá»¬A HÃ€NG

> **PhiÃªn báº£n:** 1.0.0  
> **NgÃ y cáº­p nháº­t:** 16/12/2025
> **TÃ¡c giáº£:** POS Development Team

---

## ğŸ“‹ Má»¤C Lá»¤C

1. [Tá»•ng quan há»‡ thá»‘ng](#1-tá»•ng-quan-há»‡-thá»‘ng)
2. [Kiáº¿n trÃºc phÃ¢n quyá»n](#2-kiáº¿n-trÃºc-phÃ¢n-quyá»n)
3. [CÃ¡c vai trÃ² trong há»‡ thá»‘ng](#3-cÃ¡c-vai-trÃ²-trong-há»‡-thá»‘ng)
4. [Báº£ng phÃ¢n quyá»n chi tiáº¿t](#4-báº£ng-phÃ¢n-quyá»n-chi-tiáº¿t)
5. [Thiáº¿t káº¿ Database](#5-thiáº¿t-káº¿-database)
6. [Implementation vá»›i NestJS](#6-implementation-vá»›i-nestjs)
7. [API Endpoints](#7-api-endpoints)
8. [Use Cases](#8-use-cases)
9. [Security & Best Practices](#9-security--best-practices)
10. [Testing](#10-testing)
11. [Deployment](#11-deployment)

---

## 1. Tá»”NG QUAN Há»† THá»NG

### 1.1. Giá»›i thiá»‡u

Há»‡ thá»‘ng POS (Point of Sale) quáº£n lÃ½ chuá»—i cá»­a hÃ ng vá»›i kháº£ nÄƒng multi-tenant, cho phÃ©p quáº£n lÃ½ nhiá»u chuá»—i Ä‘á»™c láº­p trong cÃ¹ng má»™t há»‡ thá»‘ng ğŸ¢

**TÃ­nh nÄƒng chÃ­nh:**
- âœ… Quáº£n lÃ½ nhiá»u chuá»—i (multi-tenant)
- âœ… Má»—i chuá»—i cÃ³ nhiá»u cá»­a hÃ ng
- âœ… Má»—i cá»­a hÃ ng cÃ³ nhiá»u nhÃ¢n viÃªn
- âœ… PhÃ¢n quyá»n chi tiáº¿t theo vai trÃ² vÃ  pháº¡m vi
- âœ… Audit logging Ä‘áº§y Ä‘á»§
- âœ… RESTful API vá»›i JWT authentication

### 1.2. MÃ´ hÃ¬nh há»‡ thá»‘ng

System (Há»‡ thá»‘ng)
â”‚
â”œâ”€â”€ Chain 1 (Chuá»—i 1: The Coffee House)
â”‚   â”œâ”€â”€ Store 1.1 (Cá»­a hÃ ng: TCH Tráº§n Duy HÆ°ng)
â”‚   â”‚   â”œâ”€â”€ User 1.1.1 (Quáº£n lÃ½)
â”‚   â”‚   â”œâ”€â”€ User 1.1.2 (Thu ngÃ¢n)
â”‚   â”‚   â””â”€â”€ User 1.1.3 (Kho)
â”‚   â”‚
â”‚   â””â”€â”€ Store 1.2 (Cá»­a hÃ ng: TCH Cáº§u Giáº¥y)
â”‚       â”œâ”€â”€ User 1.2.1 (Quáº£n lÃ½)
â”‚       â””â”€â”€ User 1.2.2 (Thu ngÃ¢n)
â”‚
â””â”€â”€ Chain 2 (Chuá»—i 2: Highlands Coffee)
â”œâ”€â”€ Store 2.1 (Cá»­a hÃ ng: HLC HoÃ n Kiáº¿m)
â””â”€â”€ Store 2.2 (Cá»­a hÃ ng: HLC Äá»‘ng Äa)


### 1.3. Tech Stack

| ThÃ nh pháº§n | CÃ´ng nghá»‡ | MÃ´ táº£ |
|------------|-----------|-------|
| **Backend Framework** | NestJS 10.x | Node.js framework vá»›i TypeScript |
| **Database** | MySQL 8.0+ / PostgreSQL 14+ | Relational database |
| **ORM** | TypeORM 0.3.x | Object-Relational Mapping |
| **Authentication** | JWT | JSON Web Token |
| **Authorization** | RBAC | Role-Based Access Control |
| **API Documentation** | Swagger/OpenAPI | Auto-generated API docs |
| **Validation** | class-validator | DTO validation |
| **Password Hashing** | bcrypt | Secure password storage |

Há»‡ thá»‘ng Ä‘Æ°á»£c xÃ¢y dá»±ng vá»›i kiáº¿n trÃºc modular, dá»… má»Ÿ rá»™ng vÃ  báº£o trÃ¬ ğŸ—ï¸

---

## 2. KIáº¾N TRÃšC PHÃ‚N QUYá»€N

### 2.1. RBAC (Role-Based Access Control)

Há»‡ thá»‘ng sá»­ dá»¥ng mÃ´ hÃ¬nh RBAC vá»›i cáº¥u trÃºc phÃ¢n cáº¥p rÃµ rÃ ng:

User (NgÆ°á»i dÃ¹ng)
â†“ has many
UserRole (Vai trÃ² cá»§a ngÆ°á»i dÃ¹ng + Scope)
â†“ belongs to
Role (Vai trÃ²)
â†“ has many
RolePermission (LiÃªn káº¿t)
â†“ grants
Permission (Quyá»n háº¡n cá»¥ thá»ƒ)


**Äáº·c Ä‘iá»ƒm:**
- ğŸ” Má»™t user cÃ³ thá»ƒ cÃ³ nhiá»u roles
- ğŸ¯ Má»—i role cÃ³ scope riÃªng (System/Chain/Store)
- ğŸ”‘ Permissions Ä‘Æ°á»£c gÃ¡n cho roles, khÃ´ng gÃ¡n trá»±c tiáº¿p cho users
- ğŸ“Š Há»— trá»£ permission constraints (giá»›i háº¡n sá»‘ tiá»n, thá»i gian, etc.)

### 2.2. Pháº¡m vi phÃ¢n quyá»n (Scope Levels)

| Level | Pháº¡m vi | VÃ­ dá»¥ vai trÃ² | MÃ´ táº£ |
|-------|---------|---------------|-------|
| **1** | System | Super Admin | ToÃ n bá»™ há»‡ thá»‘ng, táº¥t cáº£ chains |
| **2** | Chain | Chain Owner, Accountant | ToÃ n bá»™ 1 chuá»—i, táº¥t cáº£ stores trong chuá»—i |
| **3** | Store | Store Manager, Cashier | Chá»‰ 1 cá»­a hÃ ng cá»¥ thá»ƒ |

**Quy táº¯c káº¿ thá»«a:**
- Level 1 cÃ³ thá»ƒ truy cáº­p Level 2 vÃ  3
- Level 2 cÃ³ thá»ƒ truy cáº­p Level 3 trong cÃ¹ng chain
- Level 3 chá»‰ truy cáº­p Ä‘Æ°á»£c store cá»§a mÃ¬nh

### 2.3. SÆ¡ Ä‘á»“ quan há»‡ Database

```mermaid
erDiagram
    CHAINS ||--o{ STORES : contains
    CHAINS ||--o{ USERS : belongs_to
    STORES ||--o{ USERS : works_at
    STORES ||--o{ ORDERS : receives
    
    USERS ||--o{ USER_ROLES : has
    USERS ||--o{ ORDERS : creates
    USERS ||--o{ AUDIT_LOGS : performs
    
    ROLES ||--o{ USER_ROLES : assigned_to
    ROLES ||--o{ ROLE_PERMISSIONS : has
    
    PERMISSIONS ||--o{ ROLE_PERMISSIONS : granted_to
    PERMISSIONS ||--o{ PERMISSION_CONSTRAINTS : limits
    
    USER_ROLES }o--|| CHAINS : scoped_to
    USER_ROLES }o--|| STORES : scoped_to

3. CÃC VAI TRÃ’ TRONG Há»† THá»NG
3.1. ğŸ‘‘ SUPER ADMIN (Quáº£n trá»‹ há»‡ thá»‘ng)
Pháº¡m vi: ToÃ n bá»™ há»‡ thá»‘ng (Level 1)

Quyá»n háº¡n:

âœ… Quáº£n lÃ½ táº¥t cáº£ chuá»—i (CRUD)
âœ… Xem bÃ¡o cÃ¡o tá»•ng há»£p toÃ n há»‡ thá»‘ng
âœ… Quáº£n lÃ½ license, billing
âœ… Cáº¥u hÃ¬nh há»‡ thá»‘ng toÃ n cá»¥c
âœ… Backup/restore database
âœ… Quáº£n lÃ½ API keys vÃ  webhooks
âœ… Truy cáº­p má»i dá»¯ liá»‡u trong há»‡ thá»‘ng
Use cases:

NhÃ  phÃ¡t triá»ƒn há»‡ thá»‘ng
DevOps team
Technical support level 3

LÆ°u Ã½ báº£o máº­t:

âš ï¸ Chá»‰ nÃªn cÃ³ 2-3 super admin accounts
âš ï¸ Báº¯t buá»™c 2FA (Two-Factor Authentication)
âš ï¸ Log táº¥t cáº£ hÃ nh Ä‘á»™ng cá»§a super admin


3.2. ğŸ’¼ CHAIN OWNER (Chá»§ chuá»—i)
Pháº¡m vi: 1 chuá»—i cá»¥ thá»ƒ (Level 2)

Quyá»n háº¡n:

âœ… Quáº£n lÃ½ táº¥t cáº£ cá»­a hÃ ng trong chuá»—i
âœ… Táº¡o/xÃ³a/sá»­a cá»­a hÃ ng
âœ… Xem bÃ¡o cÃ¡o toÃ n chuá»—i (doanh thu, tá»“n kho, nhÃ¢n sá»±)
âœ… Quáº£n lÃ½ sáº£n pháº©m chung cho chuá»—i
âœ… Thiáº¿t láº­p giÃ¡, khuyáº¿n mÃ£i toÃ n chuá»—i
âœ… Quáº£n lÃ½ nhÃ  cung cáº¥p
âœ… PhÃ¢n quyá»n Chain Admin vÃ  Store Manager
âœ… Xem tá»“n kho real-time toÃ n chuá»—i
âŒ KhÃ´ng thá»ƒ xem/truy cáº­p chuá»—i khÃ¡c
Use cases:

CEO/Founder cá»§a chuá»—i
GiÃ¡m Ä‘á»‘c Ä‘iá»u hÃ nh (COO)
Chá»§ doanh nghiá»‡p


3.3. ğŸ¯ CHAIN ADMIN (Quáº£n trá»‹ chuá»—i)
Pháº¡m vi: 1 chuá»—i cá»¥ thá»ƒ (Level 2)

Quyá»n háº¡n:

âœ… Quáº£n lÃ½ cá»­a hÃ ng (táº¡o/sá»­a, khÃ´ng xÃ³a)
âœ… Xem bÃ¡o cÃ¡o toÃ n chuá»—i
âœ… Quáº£n lÃ½ sáº£n pháº©m
âœ… Quáº£n lÃ½ nhÃ¢n viÃªn cáº¥p Store
âœ… Thiáº¿t láº­p khuyáº¿n mÃ£i
âœ… Xem tá»“n kho toÃ n chuá»—i
âŒ KhÃ´ng xÃ³a cá»­a hÃ ng (cáº§n Chain Owner)
âŒ KhÃ´ng thay Ä‘á»•i cáº¥u hÃ¬nh thanh toÃ¡n
âŒ KhÃ´ng quáº£n lÃ½ Chain Owner
Use cases:

GiÃ¡m Ä‘á»‘c váº­n hÃ nh (Operations Manager)
TrÆ°á»Ÿng phÃ²ng kinh doanh
Assistant to CEO
Sá»± khÃ¡c biá»‡t vá»›i Chain Owner:

KhÃ´ng cÃ³ quyá»n xÃ³a cá»­a hÃ ng
KhÃ´ng thá»ƒ thay Ä‘á»•i cáº¥u hÃ¬nh tÃ i chÃ­nh quan trá»ng
KhÃ´ng thá»ƒ phÃ¢n quyá»n Chain Owner cho ngÆ°á»i khÃ¡c

3.4. ğŸª STORE MANAGER (Quáº£n lÃ½ cá»­a hÃ ng)
Pháº¡m vi: 1 cá»­a hÃ ng cá»¥ thá»ƒ (Level 3)

Quyá»n háº¡n:

âœ… Quáº£n lÃ½ nhÃ¢n viÃªn cá»­a hÃ ng (táº¡o, sá»­a, xÃ³a)
âœ… Xem bÃ¡o cÃ¡o cá»­a hÃ ng (doanh thu, ca lÃ m viá»‡c)
âœ… Quáº£n lÃ½ ca lÃ m viá»‡c (shifts)
âœ… Duyá»‡t Ä‘Æ¡n hÃ ng, hoÃ n tráº£ khÃ´ng giá»›i háº¡n
âœ… Quáº£n lÃ½ tá»“n kho cá»­a hÃ ng
âœ… Táº¡o phiáº¿u nháº­p/xuáº¥t kho
âœ… Xem lá»‹ch sá»­ giao dá»‹ch chi tiáº¿t
âœ… Chá»‰nh sá»­a giÃ¡ (trong giá»›i háº¡n Â±10%)
âœ… Má»Ÿ/Ä‘Ã³ng ca, Ä‘á»‘i soÃ¡t cuá»‘i ca
âŒ KhÃ´ng xÃ³a giao dá»‹ch Ä‘Ã£ hoÃ n thÃ nh
âŒ KhÃ´ng xem dá»¯ liá»‡u cá»­a hÃ ng khÃ¡c
Use cases:

Quáº£n lÃ½ cá»­a hÃ ng
TrÆ°á»Ÿng ca chÃ­nh
Assistant Store Manager

3.5. ğŸ‘” ASSISTANT MANAGER (PhÃ³ quáº£n lÃ½)
Pháº¡m vi: 1 cá»­a hÃ ng cá»¥ thá»ƒ (Level 3)

Quyá»n háº¡n:

âœ… Xem bÃ¡o cÃ¡o cá»­a hÃ ng (giá»›i háº¡n)
âœ… Quáº£n lÃ½ ca lÃ m viá»‡c
âœ… Duyá»‡t hoÃ n tráº£ (giá»›i háº¡n â‰¤ 500,000 VNÄ)
âœ… Xem tá»“n kho
âœ… Há»— trá»£ thu ngÃ¢n khi cáº§n
âœ… Má»Ÿ/Ä‘Ã³ng ca
âœ… Xá»­ lÃ½ khiáº¿u náº¡i khÃ¡ch hÃ ng
âŒ KhÃ´ng quáº£n lÃ½ nhÃ¢n viÃªn
âŒ KhÃ´ng táº¡o phiáº¿u nháº­p kho
âŒ KhÃ´ng xem bÃ¡o cÃ¡o tÃ i chÃ­nh chi tiáº¿t
Use cases:

PhÃ³ quáº£n lÃ½ cá»­a hÃ ng
TrÆ°á»Ÿng ca phá»¥
NhÃ¢n viÃªn senior Ä‘Æ°á»£c á»§y quyá»n


3.6. ğŸ’µ CASHIER (Thu ngÃ¢n)
Pháº¡m vi: 1 cá»­a hÃ ng cá»¥ thá»ƒ (Level 3)

Quyá»n háº¡n:

âœ… Táº¡o Ä‘Æ¡n hÃ ng
âœ… Thanh toÃ¡n (tiá»n máº·t, tháº», chuyá»ƒn khoáº£n, vÃ­ Ä‘iá»‡n tá»­)
âœ… In hÃ³a Ä‘Æ¡n
âœ… HoÃ n tráº£ (cáº§n duyá»‡t náº¿u > 200,000 VNÄ)
âœ… Xem lá»‹ch sá»­ Ä‘Æ¡n hÃ ng cá»§a mÃ¬nh trong ca
âœ… Ãp dá»¥ng khuyáº¿n mÃ£i (theo chÃ­nh sÃ¡ch)
âœ… Quáº£n lÃ½ ca cá»§a mÃ¬nh (má»Ÿ/Ä‘Ã³ng ca)
âœ… Xem thÃ´ng tin sáº£n pháº©m, giÃ¡
âŒ KhÃ´ng xem bÃ¡o cÃ¡o doanh thu
âŒ KhÃ´ng sá»­a giÃ¡ sáº£n pháº©m
âŒ KhÃ´ng xÃ³a Ä‘Æ¡n hÃ ng
âŒ KhÃ´ng xem Ä‘Æ¡n hÃ ng cá»§a ngÆ°á»i khÃ¡c
Use cases:

NhÃ¢n viÃªn thu ngÃ¢n
NhÃ¢n viÃªn bÃ¡n hÃ ng
Part-time staff

Workflow Ä‘iá»ƒn hÃ¬nh:

ğŸ”“ Má»Ÿ ca lÃ m viá»‡c
ğŸ›’ Táº¡o Ä‘Æ¡n hÃ ng
ğŸ’³ Xá»­ lÃ½ thanh toÃ¡n
ğŸ§¾ In hÃ³a Ä‘Æ¡n
ğŸ”’ ÄÃ³ng ca vÃ  Ä‘á»‘i soÃ¡t


3.7. ğŸ“¦ WAREHOUSE STAFF (NhÃ¢n viÃªn kho)
Pháº¡m vi: 1 cá»­a hÃ ng hoáº·c kho trung tÃ¢m (Level 3)

Quyá»n háº¡n:

âœ… Nháº­p kho (táº¡o phiáº¿u nháº­p)
âœ… Xuáº¥t kho (táº¡o phiáº¿u xuáº¥t)
âœ… Kiá»ƒm kÃª Ä‘á»‹nh ká»³
âœ… Xem tá»“n kho real-time
âœ… In phiáº¿u nháº­p/xuáº¥t
âœ… Quáº£n lÃ½ vá»‹ trÃ­ hÃ ng trong kho
âœ… Scan barcode/QR code
âœ… Cáº£nh bÃ¡o hÃ ng sáº¯p háº¿t
âŒ KhÃ´ng bÃ¡n hÃ ng
âŒ KhÃ´ng xem doanh thu
âŒ KhÃ´ng quáº£n lÃ½ giÃ¡
Use cases:

Thá»§ kho
NhÃ¢n viÃªn kho
Inventory controller

BÃ¡o cÃ¡o cÃ³ thá»ƒ xem:

ğŸ“Š BÃ¡o cÃ¡o tá»“n kho
ğŸ“¥ Lá»‹ch sá»­ nháº­p kho
ğŸ“¤ Lá»‹ch sá»­ xuáº¥t kho
âš ï¸ Cáº£nh bÃ¡o hÃ ng tá»“n kho tháº¥p
ğŸ“‹ BÃ¡o cÃ¡o kiá»ƒm kÃª

3.8. ğŸ’° ACCOUNTANT (Káº¿ toÃ¡n)
Pháº¡m vi: Chuá»—i hoáº·c cá»­a hÃ ng (Level 2 hoáº·c 3)

Quyá»n háº¡n:

âœ… Xem táº¥t cáº£ bÃ¡o cÃ¡o tÃ i chÃ­nh
âœ… Xem lá»‹ch sá»­ giao dá»‹ch chi tiáº¿t
âœ… Export dá»¯ liá»‡u (Excel, PDF, CSV)
âœ… Äá»‘i soÃ¡t cÃ´ng ná»£
âœ… Quáº£n lÃ½ chi phÃ­ váº­n hÃ nh
âœ… BÃ¡o cÃ¡o thuáº¿
âœ… Xem bÃ¡o cÃ¡o lÆ°Æ¡ng nhÃ¢n viÃªn
âŒ KhÃ´ng táº¡o/sá»­a Ä‘Æ¡n hÃ ng
âŒ KhÃ´ng quáº£n lÃ½ nhÃ¢n viÃªn
âŒ KhÃ´ng quáº£n lÃ½ sáº£n pháº©m
Use cases:

Káº¿ toÃ¡n trÆ°á»Ÿng
Káº¿ toÃ¡n viÃªn
Kiá»ƒm toÃ¡n viÃªn ná»™i bá»™

BÃ¡o cÃ¡o Ä‘áº·c biá»‡t:

ğŸ’µ BÃ¡o cÃ¡o doanh thu chi tiáº¿t
ğŸ’³ BÃ¡o cÃ¡o thanh toÃ¡n theo phÆ°Æ¡ng thá»©c
ğŸ“Š BÃ¡o cÃ¡o lÃ£i/lá»—
ğŸ§¾ BÃ¡o cÃ¡o thuáº¿ VAT
ğŸ’¼ BÃ¡o cÃ¡o chi phÃ­ váº­n hÃ nh


3.9. ğŸ‘€ VIEWER (NgÆ°á»i xem)
Pháº¡m vi: Chuá»—i hoáº·c cá»­a hÃ ng (Level 2 hoáº·c 3)

Quyá»n háº¡n:

âœ… Xem bÃ¡o cÃ¡o (read-only)
âœ… Xem dashboard
âœ… Xem biá»ƒu Ä‘á»“, thá»‘ng kÃª
âŒ KhÃ´ng thao tÃ¡c gÃ¬ khÃ¡c
âŒ KhÃ´ng export dá»¯ liá»‡u
âŒ KhÃ´ng xem thÃ´ng tin nháº¡y cáº£m
Use cases:

NhÃ  Ä‘áº§u tÆ°
Cá»• Ä‘Ã´ng
External auditor
Business analyst

# MA TRáº¬N PHÃ‚N QUYá»€N Há»† THá»NG POS

> **PhiÃªn báº£n:** 1.0.0  
> **NgÃ y cáº­p nháº­t:** 16/12/2024  
> **MÃ´ táº£:** Báº£ng phÃ¢n quyá»n chi tiáº¿t cho táº¥t cáº£ vai trÃ² trong há»‡ thá»‘ng POS

---

## ğŸ“‹ DANH SÃCH VAI TRÃ’

| # | Vai trÃ² | Code | Level | MÃ´ táº£ |
|---|---------|------|-------|-------|
| 1 | Super Admin | `super_admin` | 1 - System | Quáº£n trá»‹ viÃªn há»‡ thá»‘ng |
| 2 | Chain Owner | `chain_owner` | 2 - Chain | Chá»§ chuá»—i |
| 3 | Chain Admin | `chain_admin` | 2 - Chain | Quáº£n trá»‹ chuá»—i |
| 4 | Store Manager | `store_manager` | 3 - Store | Quáº£n lÃ½ cá»­a hÃ ng |
| 5 | Assistant Manager | `assistant_manager` | 3 - Store | PhÃ³ quáº£n lÃ½ |
| 6 | Cashier | `cashier` | 3 - Store | Thu ngÃ¢n |
| 7 | Warehouse Staff | `warehouse_staff` | 3 - Store | NhÃ¢n viÃªn kho |
| 8 | Accountant | `accountant` | 2/3 - Chain/Store | Káº¿ toÃ¡n |
| 9 | Viewer | `viewer` | 2/3 - Chain/Store | NgÆ°á»i xem |

---

## ğŸ” MA TRáº¬N PHÃ‚N QUYá»€N Äáº¦Y Äá»¦

### ChÃº thÃ­ch:
- âœ… = CÃ³ quyá»n Ä‘áº§y Ä‘á»§
- âœ…* = CÃ³ quyá»n nhÆ°ng giá»›i háº¡n (cáº§n duyá»‡t hoáº·c cÃ³ Ä‘iá»u kiá»‡n)
- âŒ = KhÃ´ng cÃ³ quyá»n
- ğŸ”’ = YÃªu cáº§u xÃ¡c thá»±c bá»• sung (2FA, approval)

---

## 1ï¸âƒ£ QUáº¢N LÃ CHUá»–I (CHAIN MANAGEMENT)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Xem táº¥t cáº£ chuá»—i** | `view_chains` | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Xem chuá»—i cá»§a mÃ¬nh** | `view_own_chain` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Táº¡o chuá»—i má»›i** | `create_chain` | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Sá»­a thÃ´ng tin chuá»—i** | `edit_chain` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **XÃ³a chuá»—i** | `delete_chain` | âœ… ğŸ”’ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Cáº¥u hÃ¬nh chuá»—i** | `configure_chain` | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Xem cáº¥u hÃ¬nh chuá»—i** | `view_chain_config` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |

---

## 2ï¸âƒ£ QUáº¢N LÃ Cá»¬A HÃ€NG (STORE MANAGEMENT)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Xem táº¥t cáº£ cá»­a hÃ ng** | `view_stores` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |
| **Xem cá»­a hÃ ng cá»§a mÃ¬nh** | `view_own_store` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Táº¡o cá»­a hÃ ng** | `create_store` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Sá»­a cá»­a hÃ ng** | `edit_store` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **XÃ³a cá»­a hÃ ng** | `delete_store` | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Cáº¥u hÃ¬nh cá»­a hÃ ng** | `configure_store` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Má»Ÿ/Ä‘Ã³ng cá»­a hÃ ng** | `toggle_store_status` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Xem thÃ´ng tin vá»‹ trÃ­** | `view_store_location` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |

---

## 3ï¸âƒ£ QUáº¢N LÃ NHÃ‚N VIÃŠN (USER MANAGEMENT)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Xem táº¥t cáº£ nhÃ¢n viÃªn** | `view_users` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âŒ |
| **Xem nhÃ¢n viÃªn cá»­a hÃ ng** | `view_store_users` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ |
| **Táº¡o nhÃ¢n viÃªn** | `create_user` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Sá»­a nhÃ¢n viÃªn** | `edit_user` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **XÃ³a nhÃ¢n viÃªn** | `delete_user` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **PhÃ¢n quyá»n** | `assign_roles` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Xem lÆ°Æ¡ng** | `view_salary` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âŒ |
| **Quáº£n lÃ½ lÆ°Æ¡ng** | `manage_salary` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âŒ |
| **Reset máº­t kháº©u** | `reset_password` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **KhÃ³a/má»Ÿ khÃ³a tÃ i khoáº£n** | `lock_unlock_user` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Xem há»“ sÆ¡ cÃ¡ nhÃ¢n** | `view_own_profile` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Sá»­a há»“ sÆ¡ cÃ¡ nhÃ¢n** | `edit_own_profile` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ |

---

## 4ï¸âƒ£ QUáº¢N LÃ CA LÃ€M VIá»†C (SHIFT MANAGEMENT)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Xem táº¥t cáº£ ca** | `view_shifts` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âœ… |
| **Xem ca cá»§a mÃ¬nh** | `view_own_shifts` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ |
| **Táº¡o ca lÃ m viá»‡c** | `create_shift` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| **Sá»­a ca lÃ m viá»‡c** | `edit_shift` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| **XÃ³a ca lÃ m viá»‡c** | `delete_shift` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Má»Ÿ ca** | `open_shift` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **ÄÃ³ng ca** | `close_shift` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ…* | âŒ | âŒ | âŒ |
| **ÄÃ³ng ca cá»§a ngÆ°á»i khÃ¡c** | `close_others_shift` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| **Äá»‘i soÃ¡t ca** | `reconcile_shift` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âœ… | âŒ |
| **Xem bÃ¡o cÃ¡o ca** | `view_shift_reports` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âœ… | âœ… |

**Ghi chÃº:**
- âœ…* Cashier chá»‰ cÃ³ thá»ƒ Ä‘Ã³ng ca cá»§a chÃ­nh mÃ¬nh

---

## 5ï¸âƒ£ BÃN HÃ€NG (SALES)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Xem táº¥t cáº£ Ä‘Æ¡n hÃ ng** | `view_orders` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âœ… |
| **Xem Ä‘Æ¡n cá»§a mÃ¬nh** | `view_own_orders` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âœ… | âŒ |
| **Xem Ä‘Æ¡n trong ca** | `view_shift_orders` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âœ… | âŒ |
| **Táº¡o Ä‘Æ¡n hÃ ng** | `create_order` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **Sá»­a Ä‘Æ¡n hÃ ng** | `edit_order` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| **XÃ³a Ä‘Æ¡n hÃ ng** | `delete_order` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Há»§y Ä‘Æ¡n hÃ ng** | `cancel_order` | âœ… | âœ… | âœ… | âœ… | âœ…* | âŒ | âŒ | âŒ | âŒ |
| **HoÃ n tráº£ khÃ´ng giá»›i háº¡n** | `process_refund_unlimited` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **HoÃ n tráº£ cÃ³ giá»›i háº¡n** | `process_refund_limited` | âœ… | âœ… | âœ… | âœ… | âœ…* | âœ…* | âŒ | âŒ | âŒ |
| **Duyá»‡t hoÃ n tráº£** | `approve_refund` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| **Giáº£m giÃ¡ khÃ´ng giá»›i háº¡n** | `apply_discount_unlimited` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Giáº£m giÃ¡ cÃ³ giá»›i háº¡n** | `apply_discount_limited` | âœ… | âœ… | âœ… | âœ… | âœ…* | âœ…* | âŒ | âŒ | âŒ |
| **Duyá»‡t giáº£m giÃ¡** | `approve_discount` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ |
| **Thanh toÃ¡n** | `process_payment` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **In hÃ³a Ä‘Æ¡n** | `print_invoice` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **Gá»­i hÃ³a Ä‘Æ¡n email** | `email_invoice` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |

**Giá»›i háº¡n cá»¥ thá»ƒ:**
- âœ…* **Assistant Manager**: HoÃ n tráº£ â‰¤ 500,000 VNÄ, Giáº£m giÃ¡ â‰¤ 15%
- âœ…* **Cashier**: HoÃ n tráº£ â‰¤ 200,000 VNÄ, Giáº£m giÃ¡ â‰¤ 10%

---

## 6ï¸âƒ£ QUáº¢N LÃ KHO (INVENTORY MANAGEMENT)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Xem tá»“n kho táº¥t cáº£** | `view_inventory_all` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |
| **Xem tá»“n kho cá»­a hÃ ng** | `view_inventory` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Nháº­p kho** | `stock_in` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ |
| **Xuáº¥t kho** | `stock_out` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ |
| **Kiá»ƒm kÃª** | `stock_take` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ |
| **Äiá»u chá»‰nh tá»“n kho** | `adjust_inventory` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ |
| **Chuyá»ƒn kho** | `transfer_inventory` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ |
| **Duyá»‡t chuyá»ƒn kho** | `approve_transfer` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Xem lá»‹ch sá»­ nháº­p/xuáº¥t** | `view_inventory_history` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âœ… | âœ… | âœ… |
| **In phiáº¿u nháº­p/xuáº¥t** | `print_stock_documents` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ |
| **Quáº£n lÃ½ vá»‹ trÃ­ kho** | `manage_warehouse_locations` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ |
| **Cáº£nh bÃ¡o tá»“n kho tháº¥p** | `view_low_stock_alerts` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âœ… | âŒ | âŒ |

---

## 7ï¸âƒ£ QUáº¢N LÃ Sáº¢N PHáº¨M (PRODUCT MANAGEMENT)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Xem táº¥t cáº£ sáº£n pháº©m** | `view_products` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Táº¡o sáº£n pháº©m** | `create_product` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Sá»­a sáº£n pháº©m** | `edit_product` | âœ… | âœ… | âœ… | âœ…* | âŒ | âŒ | âŒ | âŒ | âŒ |
| **XÃ³a sáº£n pháº©m** | `delete_product` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **áº¨n/hiá»‡n sáº£n pháº©m** | `toggle_product_visibility` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Quáº£n lÃ½ giÃ¡** | `manage_product_price` | âœ… | âœ… | âœ… | âœ…* | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Quáº£n lÃ½ danh má»¥c** | `manage_categories` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Upload áº£nh sáº£n pháº©m** | `upload_product_images` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Quáº£n lÃ½ biáº¿n thá»ƒ** | `manage_product_variants` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Quáº£n lÃ½ barcode** | `manage_product_barcode` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ |

**Giá»›i háº¡n cá»¥ thá»ƒ:**
- âœ…* **Store Manager**: Chá»‰ Ä‘Æ°á»£c thay Ä‘á»•i giÃ¡ Â±10%, cáº§n duyá»‡t náº¿u vÆ°á»£t quÃ¡

---

## 8ï¸âƒ£ KHUYáº¾N MÃƒI (PROMOTION MANAGEMENT)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Xem khuyáº¿n mÃ£i** | `view_promotions` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âœ… | âœ… |
| **Táº¡o khuyáº¿n mÃ£i** | `create_promotion` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Sá»­a khuyáº¿n mÃ£i** | `edit_promotion` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **XÃ³a khuyáº¿n mÃ£i** | `delete_promotion` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **KÃ­ch hoáº¡t khuyáº¿n mÃ£i** | `activate_promotion` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Ãp dá»¥ng khuyáº¿n mÃ£i** | `apply_promotion` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **Xem bÃ¡o cÃ¡o khuyáº¿n mÃ£i** | `view_promotion_reports` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âœ… |

---

## 9ï¸âƒ£ KHÃCH HÃ€NG (CUSTOMER MANAGEMENT)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Xem khÃ¡ch hÃ ng** | `view_customers` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **Táº¡o khÃ¡ch hÃ ng** | `create_customer` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **Sá»­a khÃ¡ch hÃ ng** | `edit_customer` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **XÃ³a khÃ¡ch hÃ ng** | `delete_customer` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Quáº£n lÃ½ Ä‘iá»ƒm tÃ­ch lÅ©y** | `manage_loyalty_points` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ |
| **Xem lá»‹ch sá»­ mua hÃ ng** | `view_customer_history` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âœ… | âŒ |
| **Export danh sÃ¡ch KH** | `export_customers` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âŒ |

---

## ğŸ”Ÿ NHÃ€ CUNG Cáº¤P (SUPPLIER MANAGEMENT)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Xem nhÃ  cung cáº¥p** | `view_suppliers` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âœ… | âŒ |
| **Táº¡o nhÃ  cung cáº¥p** | `create_supplier` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Sá»­a nhÃ  cung cáº¥p** | `edit_supplier` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **XÃ³a nhÃ  cung cáº¥p** | `delete_supplier` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Quáº£n lÃ½ cÃ´ng ná»£** | `manage_supplier_debt` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âœ… | âŒ |
| **Xem lá»‹ch sá»­ giao dá»‹ch** | `view_supplier_transactions` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âœ… | âŒ |

---

## 1ï¸âƒ£1ï¸âƒ£ BÃO CÃO (REPORTS)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **BÃ¡o cÃ¡o toÃ n há»‡ thá»‘ng** | `view_system_reports` | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **BÃ¡o cÃ¡o chuá»—i** | `view_chain_reports` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |
| **BÃ¡o cÃ¡o cá»­a hÃ ng** | `view_store_reports` | âœ… | âœ… | âœ… | âœ… | âœ…* | âŒ | âŒ | âœ… | âœ… |
| **BÃ¡o cÃ¡o cÃ¡ nhÃ¢n** | `view_own_reports` | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ |
| **BÃ¡o cÃ¡o doanh thu** | `view_revenue_reports` | âœ… | âœ… | âœ… | âœ… | âœ…* | âŒ | âŒ | âœ… | âœ… |
| **BÃ¡o cÃ¡o lá»£i nhuáº­n** | `view_profit_reports` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âœ…* |
| **BÃ¡o cÃ¡o tá»“n kho** | `view_inventory_reports` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âœ… | âœ… | âœ… |
| **BÃ¡o cÃ¡o nhÃ¢n sá»±** | `view_staff_reports` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âŒ |
| **BÃ¡o cÃ¡o thuáº¿** | `view_tax_reports` | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âœ… | âŒ |
| **BÃ¡o cÃ¡o tÃ i chÃ­nh** | `view_financial_reports` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âœ…* |
| **Export dá»¯ liá»‡u** | `export_data` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âŒ |
| **Export Excel** | `export_excel` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âŒ |
| **Export PDF** | `export_pdf` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âŒ |
| **Dashboard tá»•ng quan** | `view_dashboard` | âœ… | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âœ… | âœ… |

**Giá»›i háº¡n cá»¥ thá»ƒ:**
- âœ…* **Assistant Manager**: Chá»‰ xem bÃ¡o cÃ¡o doanh thu, khÃ´ng xem chi tiáº¿t lá»£i nhuáº­n
- âœ…* **Viewer**: Xem bÃ¡o cÃ¡o tÃ i chÃ­nh tá»•ng quan, khÃ´ng xem chi tiáº¿t

---

## 1ï¸âƒ£2ï¸âƒ£ Cáº¤U HÃŒNH Há»† THá»NG (SYSTEM CONFIGURATION)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Cáº¥u hÃ¬nh há»‡ thá»‘ng** | `configure_system` | âœ… ğŸ”’ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Cáº¥u hÃ¬nh thanh toÃ¡n** | `configure_payment` | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Cáº¥u hÃ¬nh in áº¥n** | `configure_printing` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Cáº¥u hÃ¬nh email** | `configure_email` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Cáº¥u hÃ¬nh SMS** | `configure_sms` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Cáº¥u hÃ¬nh thuáº¿** | `configure_tax` | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Quáº£n lÃ½ API keys** | `manage_api_keys` | âœ… ğŸ”’ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Backup database** | `backup_database` | âœ… ğŸ”’ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Restore database** | `restore_database` | âœ… ğŸ”’ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Xem system logs** | `view_system_logs` | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Xem audit logs** | `view_audit_logs` | âœ… | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âœ… | âŒ |

---

## 1ï¸âƒ£3ï¸âƒ£ TÃCH Há»¢P (INTEGRATIONS)

| Chá»©c nÄƒng | Permission Code | Super Admin | Chain Owner | Chain Admin | Store Manager | Asst Manager | Cashier | Warehouse | Accountant | Viewer |
|-----------|----------------|:-----------:|:-----------:|:-----------:|:-------------:|:------------:|:-------:|:---------:|:----------:|:------:|
| **Quáº£n lÃ½ tÃ­ch há»£p** | `manage_integrations` | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **Webhook management** | `manage_webhooks` | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **TÃ­ch há»£p thanh toÃ¡n** | `integrate_payment_gateway` | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **TÃ­ch há»£p váº­n chuyá»ƒn** | `integrate_shipping` | âœ… | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ |
| **TÃ­ch há»£p káº¿ toÃ¡n** | `integrate_accounting` | âœ… | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âœ… | âŒ |

---

## ğŸ“Š Tá»”NG Há»¢P PERMISSIONS THEO VAI TRÃ’

### Super Admin (100+ permissions)
```typescript
const SUPER_ADMIN_PERMISSIONS = ['*']; // Wildcard - táº¥t cáº£ quyá»n



5. THIáº¾T Káº¾ DATABASE
5.1. Complete Database Schema

-- =============================================
-- Báº¢NG CHAINS (CHUá»–I)
-- =============================================
CREATE TABLE chains (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL COMMENT 'TÃªn chuá»—i',
    code VARCHAR(50) UNIQUE NOT NULL COMMENT 'MÃ£ chuá»—i',
    status ENUM('active', 'inactive', 'suspended') DEFAULT 'active',
    logo_url VARCHAR(500) COMMENT 'URL logo',
    description TEXT COMMENT 'MÃ´ táº£',
    website VARCHAR(255) COMMENT 'Website',
    email VARCHAR(255) COMMENT 'Email',
    phone VARCHAR(20) COMMENT 'Sá»‘ Ä‘iá»‡n thoáº¡i',
    address TEXT COMMENT 'Äá»‹a chá»‰ trá»¥ sá»Ÿ',
    tax_code VARCHAR(50) COMMENT 'MÃ£ sá»‘ thuáº¿',
    settings JSON COMMENT 'Cáº¥u hÃ¬nh',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_code (code),
    INDEX idx_status (status),
    FULLTEXT INDEX ft_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- =============================================
-- Báº¢NG STORES (Cá»¬A HÃ€NG)
-- =============================================
CREATE TABLE stores (
    id INT PRIMARY KEY AUTO_INCREMENT,
    chain_id INT NOT NULL,
    name VARCHAR(255) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    address TEXT,
    ward VARCHAR(100),
    district VARCHAR(100),
    city VARCHAR(100),
    phone VARCHAR(20),
    email VARCHAR(255),
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    status ENUM('active', 'inactive', 'maintenance') DEFAULT 'active',
    opening_time TIME,
    closing_time TIME,
    area_sqm DECIMAL(10, 2),
    capacity INT,
    settings JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (chain_id) REFERENCES chains(id) ON DELETE CASCADE,
    INDEX idx_chain_id (chain_id),
    INDEX idx_code (code),
    INDEX idx_status (status),
    FULLTEXT INDEX ft_address (name, address)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- =============================================
-- Báº¢NG USERS (NHÃ‚N VIÃŠN)
-- =============================================
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    chain_id INT,
    store_id INT,
    username VARCHAR(100) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    full_name VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    avatar_url VARCHAR(500),
    date_of_birth DATE,
    gender ENUM('male', 'female', 'other'),
    address TEXT,
    citizen_id VARCHAR(20),
    status ENUM('active', 'inactive', 'suspended') DEFAULT 'active',
    two_factor_enabled BOOLEAN DEFAULT FALSE,
    two_factor_secret VARCHAR(255),
    last_login_at TIMESTAMP NULL,
    last_login_ip VARCHAR(45),
    password_changed_at TIMESTAMP NULL,
    failed_login_attempts INT DEFAULT 0,
    locked_until TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (chain_id) REFERENCES chains(id) ON DELETE CASCADE,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_chain_id (chain_id),
    INDEX idx_store_id (store_id),
    INDEX idx_status (status),
    FULLTEXT INDEX ft_user_search (full_name, email, phone)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- =============================================
-- Báº¢NG ROLES (VAI TRÃ’)
-- =============================================
CREATE TABLE roles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    level INT NOT NULL COMMENT '1=System, 2=Chain, 3=Store',
    is_system BOOLEAN DEFAULT FALSE,
    color VARCHAR(7),
    icon VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_code (code),
    INDEX idx_level (level)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- =============================================
-- Báº¢NG PERMISSIONS (QUYá»€N Háº N)
-- =============================================
CREATE TABLE permissions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    module VARCHAR(50) NOT NULL,
    description TEXT,
    is_system BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_code (code),
    INDEX idx_module (module)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- =============================================
-- Báº¢NG ROLE_PERMISSIONS
-- =============================================
CREATE TABLE role_permissions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    role_id INT NOT NULL,
    permission_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,
    UNIQUE KEY unique_role_permission (role_id, permission_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- =============================================
-- Báº¢NG USER_ROLES
-- =============================================
CREATE TABLE user_roles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    role_id INT NOT NULL,
    chain_id INT,
    store_id INT,
    assigned_by INT,
    assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (chain_id) REFERENCES chains(id) ON DELETE CASCADE,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (assigned_by) REFERENCES users(id) ON DELETE SET NULL,
    UNIQUE KEY unique_user_role_scope (user_id, role_id, chain_id, store_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- =============================================
-- Báº¢NG PERMISSION_CONSTRAINTS
-- =============================================
CREATE TABLE permission_constraints (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    permission_id INT NOT NULL,
    constraint_type VARCHAR(50) NOT NULL,
    constraint_value JSON NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- =============================================
-- Báº¢NG ORDERS (ÄÆ N HÃ€NG)
-- =============================================
CREATE TABLE orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    store_id INT NOT NULL,
    user_id INT NOT NULL,
    order_code VARCHAR(50) UNIQUE NOT NULL,
    customer_name VARCHAR(255),
    customer_phone VARCHAR(20),
    customer_email VARCHAR(255),
    order_type ENUM('dine_in', 'takeaway', 'delivery') DEFAULT 'dine_in',
    table_number VARCHAR(20),
    subtotal DECIMAL(15, 2) NOT NULL,
    discount DECIMAL(15, 2) DEFAULT 0,
    discount_type ENUM('amount', 'percentage'),
    tax DECIMAL(15, 2) DEFAULT 0,
    service_charge DECIMAL(15, 2) DEFAULT 0,
    total DECIMAL(15, 2) NOT NULL,
    payment_method ENUM('cash', 'card', 'transfer', 'e-wallet', 'mixed'),
    payment_details JSON,
    paid_amount DECIMAL(15, 2) DEFAULT 0,
    change_amount DECIMAL(15, 2) DEFAULT 0,
    status ENUM('draft', 'pending', 'completed', 'cancelled', 'refunded') DEFAULT 'pending',
    items JSON NOT NULL,
    note TEXT,
    refund_reason TEXT,
    refund_amount DECIMAL(15, 2),
    refunded_at TIMESTAMP NULL,
    refunded_by INT,
    approved_by INT,
    shift_id INT,
    completed_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (refunded_by) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_store_id (store_id),
    INDEX idx_order_code (order_code),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- =============================================
-- Báº¢NG SHIFTS (CA LÃ€M VIá»†C)
-- =============================================
CREATE TABLE shifts (
    id INT PRIMARY KEY AUTO_INCREMENT,
    store_id INT NOT NULL,
    user_id INT NOT NULL,
    shift_code VARCHAR(50) UNIQUE NOT NULL,
    opened_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    closed_at TIMESTAMP NULL,
    opening_cash DECIMAL(15, 2) NOT NULL,
    closing_cash DECIMAL(15, 2),
    expected_cash DECIMAL(15, 2),
    cash_difference DECIMAL(15, 2),
    total_sales DECIMAL(15, 2) DEFAULT 0,
    total_orders INT DEFAULT 0,
    total_refunds DECIMAL(15, 2) DEFAULT 0,
    status ENUM('open', 'closed') DEFAULT 'open',
    note TEXT,
    closed_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (closed_by) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_store_id (store_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- =============================================
-- Báº¢NG AUDIT_LOGS (NHáº¬T KÃ HOáº T Äá»˜NG)
-- =============================================
CREATE TABLE audit_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    action VARCHAR(50) NOT NULL,
    model VARCHAR(50) NOT NULL,
    model_id INT,
    old_values JSON,
    new_values JSON,
    ip_address VARCHAR(45),
    user_agent TEXT,
    request_url VARCHAR(500),
    request_method VARCHAR(10),
    response_status INT,
    execution_time INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_user_id (user_id),
    INDEX idx_action (action),
    INDEX idx_model (model),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


5.2. Seed Data (Dá»¯ liá»‡u máº«u)

-- INSERT PERMISSIONS
INSERT INTO permissions (name, code, module, is_system) VALUES
-- Chain management
('View Chains', 'view_chains', 'chain', TRUE),
('Create Chain', 'create_chain', 'chain', TRUE),
('Edit Chain', 'edit_chain', 'chain', TRUE),
('Delete Chain', 'delete_chain', 'chain', TRUE),

-- Store management
('View Stores', 'view_stores', 'store', TRUE),
('Create Store', 'create_store', 'store', TRUE),
('Edit Store', 'edit_store', 'store', TRUE),
('Delete Store', 'delete_store', 'store', TRUE),

-- User management
('View Users', 'view_users', 'user', TRUE),
('Create User', 'create_user', 'user', TRUE),
('Edit User', 'edit_user', 'user', TRUE),
('Delete User', 'delete_user', 'user', TRUE),

-- Sales
('View Orders', 'view_orders', 'sales', TRUE),
('Create Order', 'create_order', 'sales', TRUE),
('Edit Order', 'edit_order', 'sales', TRUE),
('Delete Order', 'delete_order', 'sales', TRUE),
('Process Refund', 'process_refund', 'sales', TRUE),
('Apply Discount', 'apply_discount', 'sales', TRUE),

-- Inventory
('View Inventory', 'view_inventory', 'inventory', TRUE),
('Stock In', 'stock_in', 'inventory', TRUE),
('Stock Out', 'stock_out', 'inventory', TRUE),
('Stock Take', 'stock_take', 'inventory', TRUE),

-- Products
('View Products', 'view_products', 'product', TRUE),
('Create Product', 'create_product', 'product', TRUE),
('Edit Product', 'edit_product', 'product', TRUE),
('Delete Product', 'delete_product', 'product', TRUE),

-- Reports
('View System Reports', 'view_system_reports', 'report', TRUE),
('View Chain Reports', 'view_chain_reports', 'report', TRUE),
('View Store Reports', 'view_store_reports', 'report', TRUE),
('Export Data', 'export_data', 'report', TRUE),

-- Shifts
('Manage Shifts', 'manage_shifts', 'shift', TRUE),
('Close Shift', 'close_shift', 'shift', TRUE),
('Manage Own Shift', 'manage_own_shift', 'shift', TRUE);

-- INSERT ROLES
INSERT INTO roles (name, code, level, is_system, description) VALUES
('Super Admin', 'super_admin', 1, TRUE, 'Quáº£n trá»‹ viÃªn há»‡ thá»‘ng'),
('Chain Owner', 'chain_owner', 2, TRUE, 'Chá»§ chuá»—i'),
('Chain Admin', 'chain_admin', 2, TRUE, 'Quáº£n trá»‹ chuá»—i'),
('Store Manager', 'store_manager', 3, TRUE, 'Quáº£n lÃ½ cá»­a hÃ ng'),
('Assistant Manager', 'assistant_manager', 3, TRUE, 'PhÃ³ quáº£n lÃ½'),
('Cashier', 'cashier', 3, TRUE, 'Thu ngÃ¢n'),
('Warehouse Staff', 'warehouse_staff', 3, TRUE, 'NhÃ¢n viÃªn kho'),
('Accountant', 'accountant', 2, TRUE, 'Káº¿ toÃ¡n'),
('Viewer', 'viewer', 2, TRUE, 'NgÆ°á»i xem');

-- ASSIGN PERMISSIONS TO ROLES
-- Super Admin - All permissions
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'super_admin';

-- Chain Owner
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'chain_owner'
AND p.code IN (
    'view_stores', 'create_store', 'edit_store', 'delete_store',
    'view_users', 'create_user', 'edit_user', 'delete_user',
    'view_products', 'create_product', 'edit_product', 'delete_product',
    'view_inventory', 'stock_in', 'stock_out', 'stock_take',
    'view_orders', 'create_order', 'edit_order', 'delete_order',
    'process_refund', 'apply_discount',
    'view_chain_reports', 'view_store_reports', 'export_data'
);

-- Store Manager
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'store_manager'
AND p.code IN (
    'view_users', 'create_user', 'edit_user', 'delete_user',
    'view_orders', 'create_order', 'edit_order', 'process_refund', 'apply_discount',
    'view_inventory', 'stock_in', 'stock_out', 'stock_take',
    'view_products', 'edit_product',
    'view_store_reports', 'export_data',
    'manage_shifts', 'close_shift'
);

-- Cashier
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'cashier'
AND p.code IN (
    'view_orders', 'create_order', 'process_refund', 'apply_discount',
    'view_products', 'view_inventory',
    'manage_own_shift'
);

-- Warehouse Staff
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'warehouse_staff'
AND p.code IN (
    'view_inventory', 'stock_in', 'stock_out', 'stock_take',
    'view_products'
);

-- Accountant
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'accountant'
AND p.code IN (
    'view_chain_reports', 'view_store_reports', 'export_data'
);

-- CREATE SAMPLE DATA
-- Chain
INSERT INTO chains (name, code, status) VALUES
('The Coffee House', 'TCH', 'active');

SET @chain_id = LAST_INSERT_ID();

-- Stores
INSERT INTO stores (chain_id, name, code, address, phone, status) VALUES
(@chain_id, 'TCH Tráº§n Duy HÆ°ng', 'TCH-TDH', '123 Tráº§n Duy HÆ°ng, Cáº§u Giáº¥y, HÃ  Ná»™i', '0241234567', 'active'),
(@chain_id, 'TCH Cáº§u Giáº¥y', 'TCH-CG', '456 Cáº§u Giáº¥y, HÃ  Ná»™i', '0241234568', 'active');

SET @store1_id = (SELECT id FROM stores WHERE code = 'TCH-TDH');
SET @store2_id = (SELECT id FROM stores WHERE code = 'TCH-CG');

-- Users (password: password123 - hashed with bcrypt)
INSERT INTO users (username, email, password, full_name, chain_id, store_id, status) VALUES
('superadmin', 'superadmin@pos.com', '$2b$10$YourHashedPasswordHere', 'Super Administrator', NULL, NULL, 'active'),
('owner', 'owner@tch.com', '$2b$10$YourHashedPasswordHere', 'Nguyá»…n VÄƒn A', @chain_id, NULL, 'active'),
('manager1', 'manager1@tch.com', '$2b$10$YourHashedPasswordHere', 'Tráº§n Thá»‹ B', @chain_id, @store1_id, 'active'),
('cashier1', 'cashier1@tch.com', '$2b$10$YourHashedPasswordHere', 'LÃª VÄƒn C', @chain_id, @store1_id, 'active'),
('warehouse1', 'warehouse1@tch.com', '$2b$10$YourHashedPasswordHere', 'Pháº¡m Thá»‹ D', @chain_id, @store1_id, 'active');

-- Assign Roles
INSERT INTO user_roles (user_id, role_id, chain_id, store_id)
SELECT u.id, r.id, NULL, NULL
FROM users u, roles r
WHERE u.username = 'superadmin' AND r.code = 'super_admin';

INSERT INTO user_roles (user_id, role_id, chain_id, store_id)
SELECT u.id, r.id, @chain_id, NULL
FROM users u, roles r
WHERE u.username = 'owner' AND r.code = 'chain_owner';

INSERT INTO user_roles (user_id, role_id, chain_id, store_id)
SELECT u.id, r.id, @chain_id, @store1_id
FROM users u, roles r
WHERE u.username = 'manager1' AND r.code = 'store_manager';

INSERT INTO user_roles (user_id, role_id, chain_id, store_id)
SELECT u.id, r.id, @chain_id, @store1_id
FROM users u, roles r
WHERE u.username = 'cashier1' AND r.code = 'cashier';

INSERT INTO user_roles (user_id, role_id, chain_id, store_id)
SELECT u.id, r.id, @chain_id, @store1_id
FROM users u, roles r
WHERE u.username = 'warehouse1' AND r.code = 'warehouse_staff';
